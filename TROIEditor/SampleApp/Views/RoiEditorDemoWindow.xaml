<Window
    x:Class="TROIEditor.SampleApp.Views.RoiEditorDemoWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:TROIEditor.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewModels="clr-namespace:TROIEditor.SampleApp.ViewModels"
    Title="{Binding Title}"
    Width="1200"
    Height="800"
    d:DataContext="{d:DesignInstance Type=viewModels:RoiEditorDemoViewModel,
                                     IsDesignTimeCreatable=True}"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">

    <Window.Resources>
        <!--  工具按钮样式  -->
        <Style x:Key="ToolButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="40" />
            <Setter Property="Height" Value="40" />
            <Setter Property="Margin" Value="2" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderBrush" Value="DarkGray" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Cursor" Value="Hand" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="LightBlue" />
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="LightSteelBlue" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <!--  分组样式  -->
        <Style x:Key="ToolGroupStyle" TargetType="GroupBox">
            <Setter Property="Margin" Value="2" />
            <Setter Property="Padding" Value="5" />
            <Setter Property="Background" Value="WhiteSmoke" />
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!--  菜单栏  -->
        <Menu Grid.Row="0">
            <MenuItem Header="文件(_F)">
                <MenuItem Command="{Binding RoiEditorViewModel.LoadImageCommand}" Header="加载图像(_L)" />
                <Separator />
                <MenuItem Command="{Binding RoiEditorViewModel.SaveRoisToJsonCommand}" Header="保存 ROI 数据(_S)" />
                <MenuItem Command="{Binding RoiEditorViewModel.LoadRoisFromJsonCommand}" Header="加载 ROI 数据(_O)" />
                <Separator />
                <MenuItem Command="{Binding RoiEditorViewModel.ExportMaskCommand}" Header="导出掩码(_E)" />
                <Separator />
                <MenuItem Command="{Binding ExitCommand}" Header="退出(_X)" />
            </MenuItem>
            <MenuItem Header="编辑(_E)">
                <MenuItem
                    Command="{Binding RoiEditorViewModel.SelectAllCommand}"
                    Header="全选(_A)"
                    InputGestureText="Ctrl+A" />
                <MenuItem
                    Command="{Binding RoiEditorViewModel.DeleteSelectedCommand}"
                    Header="删除选中(_D)"
                    InputGestureText="Delete" />
                <MenuItem Command="{Binding RoiEditorViewModel.ClearAllCommand}" Header="清空所有(_C)" />
            </MenuItem>
            <MenuItem Header="视图(_V)">
                <MenuItem Command="{Binding RoiEditorViewModel.ZoomInCommand}" Header="放大(_I)" />
                <MenuItem Command="{Binding RoiEditorViewModel.ZoomOutCommand}" Header="缩小(_O)" />
                <MenuItem Command="{Binding RoiEditorViewModel.ZoomResetCommand}" Header="重置缩放(_R)" />
                <MenuItem Command="{Binding RoiEditorViewModel.ZoomToFitCommand}" Header="适合窗口(_F)" />
            </MenuItem>
            <MenuItem Header="帮助(_H)">
                <MenuItem Command="{Binding ShowAboutCommand}" Header="关于(_A)" />
            </MenuItem>
        </Menu>

        <!--  工具栏  -->
        <ToolBarTray Grid.Row="1" Background="LightGray">
            <ToolBar>
                <!--  文件操作  -->
                <GroupBox Header="文件" Style="{StaticResource ToolGroupStyle}">
                    <StackPanel Orientation="Horizontal">
                        <Button
                            Command="{Binding RoiEditorViewModel.LoadImageCommand}"
                            Style="{StaticResource ToolButtonStyle}"
                            ToolTip="加载图像">
                            <TextBlock FontSize="16" Text="📁" />
                        </Button>
                        <Button
                            Command="{Binding RoiEditorViewModel.SaveRoisToJsonCommand}"
                            Style="{StaticResource ToolButtonStyle}"
                            ToolTip="保存 ROI">
                            <TextBlock FontSize="16" Text="💾" />
                        </Button>
                        <Button
                            Command="{Binding RoiEditorViewModel.ExportMaskCommand}"
                            Style="{StaticResource ToolButtonStyle}"
                            ToolTip="导出掩码">
                            <TextBlock FontSize="16" Text="📤" />
                        </Button>
                    </StackPanel>
                </GroupBox>

                <Separator />

                <!--  工具选择  -->
                <GroupBox Header="工具" Style="{StaticResource ToolGroupStyle}">
                    <StackPanel Orientation="Horizontal">
                        <Button
                            Command="{Binding RoiEditorViewModel.SelectToolCommand}"
                            Style="{StaticResource ToolButtonStyle}"
                            ToolTip="选择工具">
                            <TextBlock FontSize="16" Text="👆" />
                        </Button>
                        <Button
                            Command="{Binding RoiEditorViewModel.PanToolCommand}"
                            Style="{StaticResource ToolButtonStyle}"
                            ToolTip="平移工具">
                            <TextBlock FontSize="16" Text="✋" />
                        </Button>
                    </StackPanel>
                </GroupBox>

                <Separator />

                <!--  ROI 创建工具  -->
                <GroupBox Header="ROI 工具" Style="{StaticResource ToolGroupStyle}">
                    <StackPanel Orientation="Horizontal">
                        <Button
                            Command="{Binding RoiEditorViewModel.NewRectangleCommand}"
                            Style="{StaticResource ToolButtonStyle}"
                            ToolTip="创建矩形">
                            <TextBlock FontSize="16" Text="⬛" />
                        </Button>
                        <Button
                            Command="{Binding RoiEditorViewModel.NewEllipseCommand}"
                            Style="{StaticResource ToolButtonStyle}"
                            ToolTip="创建椭圆">
                            <TextBlock FontSize="16" Text="⬭" />
                        </Button>
                        <Button
                            Command="{Binding RoiEditorViewModel.NewCircleCommand}"
                            Style="{StaticResource ToolButtonStyle}"
                            ToolTip="创建圆形">
                            <TextBlock FontSize="16" Text="⬤" />
                        </Button>
                        <Button
                            Command="{Binding RoiEditorViewModel.NewPolygonCommand}"
                            Style="{StaticResource ToolButtonStyle}"
                            ToolTip="创建多边形">
                            <TextBlock FontSize="16" Text="🔷" />
                        </Button>
                        <Button
                            Command="{Binding RoiEditorViewModel.NewSectorCommand}"
                            Style="{StaticResource ToolButtonStyle}"
                            ToolTip="创建圆弧">
                            <TextBlock FontSize="16" Text="◗" />
                        </Button>
                    </StackPanel>
                </GroupBox>

                <Separator />

                <!--  布尔运算  -->
                <GroupBox Header="布尔运算" Style="{StaticResource ToolGroupStyle}">
                    <StackPanel Orientation="Horizontal">
                        <Button
                            Command="{Binding RoiEditorViewModel.UnionCommand}"
                            Style="{StaticResource ToolButtonStyle}"
                            ToolTip="并集">
                            <TextBlock FontSize="16" Text="∪" />
                        </Button>
                        <Button
                            Command="{Binding RoiEditorViewModel.IntersectCommand}"
                            Style="{StaticResource ToolButtonStyle}"
                            ToolTip="交集">
                            <TextBlock FontSize="16" Text="∩" />
                        </Button>
                        <Button
                            Command="{Binding RoiEditorViewModel.SubtractCommand}"
                            Style="{StaticResource ToolButtonStyle}"
                            ToolTip="差集">
                            <TextBlock FontSize="16" Text="−" />
                        </Button>
                    </StackPanel>
                </GroupBox>

                <Separator />

                <!--  编辑操作  -->
                <GroupBox Header="编辑" Style="{StaticResource ToolGroupStyle}">
                    <StackPanel Orientation="Horizontal">
                        <Button
                            Command="{Binding RoiEditorViewModel.DeleteRoiCommand}"
                            Style="{StaticResource ToolButtonStyle}"
                            ToolTip="删除选中">
                            <TextBlock FontSize="16" Text="🗑️" />
                        </Button>
                        <Button
                            Command="{Binding RoiEditorViewModel.ClearAllCommand}"
                            Style="{StaticResource ToolButtonStyle}"
                            ToolTip="清空全部">
                            <TextBlock FontSize="16" Text="🧹" />
                        </Button>
                    </StackPanel>
                </GroupBox>

                <Separator />

                <!--  视图控制  -->
                <GroupBox Header="视图" Style="{StaticResource ToolGroupStyle}">
                    <StackPanel Orientation="Horizontal">
                        <Button
                            Command="{Binding RoiEditorViewModel.ZoomInCommand}"
                            Style="{StaticResource ToolButtonStyle}"
                            ToolTip="放大">
                            <TextBlock FontSize="12" Text="🔍+" />
                        </Button>
                        <Button
                            Command="{Binding RoiEditorViewModel.ZoomOutCommand}"
                            Style="{StaticResource ToolButtonStyle}"
                            ToolTip="缩小">
                            <TextBlock FontSize="12" Text="🔍−" />
                        </Button>
                        <Button
                            Command="{Binding RoiEditorViewModel.ZoomResetCommand}"
                            Style="{StaticResource ToolButtonStyle}"
                            ToolTip="重置缩放">
                            <TextBlock FontSize="12" Text="🔍=" />
                        </Button>
                        <Button
                            Command="{Binding RoiEditorViewModel.ZoomToFitCommand}"
                            Style="{StaticResource ToolButtonStyle}"
                            ToolTip="适合窗口">
                            <TextBlock FontSize="16" Text="⛶" />
                        </Button>
                    </StackPanel>
                </GroupBox>
            </ToolBar>
        </ToolBarTray>

        <!--  主编辑区域  -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="200" />
            </Grid.ColumnDefinitions>

            <!--  ROI 编辑器  -->
            <Border
                Grid.Column="0"
                Margin="2"
                BorderBrush="DarkGray"
                BorderThickness="1">
                <controls:RoiEditorControl ViewModel="{Binding RoiEditorViewModel, Mode=TwoWay}" />
            </Border>

            <!--  分隔器  -->
            <GridSplitter
                Grid.Column="1"
                Width="3"
                HorizontalAlignment="Stretch"
                Background="LightGray" />

            <!--  属性面板  -->
            <Border
                Grid.Column="2"
                Margin="2"
                Background="White"
                BorderBrush="DarkGray"
                BorderThickness="1">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="5">
                        <TextBlock
                            Margin="0,0,0,10"
                            FontWeight="Bold"
                            Text="属性面板" />

                        <!--  当前工具  -->
                        <GroupBox Margin="0,0,0,10" Header="当前工具">
                            <TextBlock FontWeight="Bold" Text="{Binding RoiEditorViewModel.CurrentTool}" />
                        </GroupBox>

                        <!--  图像信息  -->
                        <GroupBox Margin="0,0,0,10" Header="图像信息">
                            <StackPanel>
                                <TextBlock>
                                    <TextBlock.Text>
                                        <MultiBinding StringFormat="尺寸: {0:F0} x {1:F0}">
                                            <Binding Path="RoiEditorViewModel.ImageSize.Width" />
                                            <Binding Path="RoiEditorViewModel.ImageSize.Height" />
                                        </MultiBinding>
                                    </TextBlock.Text>
                                </TextBlock>
                                <TextBlock Text="{Binding RoiEditorViewModel.Zoom, StringFormat=缩放: {0:F2}x}" />
                            </StackPanel>
                        </GroupBox>

                        <!--  ROI 统计  -->
                        <GroupBox Margin="0,0,0,10" Header="ROI 统计">
                            <StackPanel>
                                <TextBlock Text="{Binding RoiEditorViewModel.Rois.Count, StringFormat=总数: {0}}" />
                                <TextBlock Text="{Binding RoiEditorViewModel.SelectedRois.Count, StringFormat=已选中: {0}}" />
                            </StackPanel>
                        </GroupBox>

                        <!--  ROI 列表  -->
                        <GroupBox Header="ROI 列表">
                            <ListBox
                                MaxHeight="300"
                                ItemsSource="{Binding RoiEditorViewModel.Rois}"
                                ScrollViewer.VerticalScrollBarVisibility="Auto">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <CheckBox Margin="0,0,5,0" IsChecked="{Binding IsSelected}" />
                                            <TextBlock Text="{Binding Name}" />
                                            <TextBlock
                                                FontSize="10"
                                                Foreground="Gray"
                                                Text="{Binding Id, StringFormat=' ({0:F0})'}" />
                                        </StackPanel>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>


    </Grid>
</Window>